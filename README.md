# redrockBE-WHaccessment
红岩后端部门寒假考核
## 一.已实现功能
### 1.用户模块
1. 用户注册:顾名思义
2. 用户登录:顾名思义
3. 用户注销:顾名思义
4. 修改个人资料:顾名思义
5. bcrypt加密:使用bcrypt包对密码加盐哈希
6. 刷新Token(双Token)及其中间件:使用refreshToken获得新的accessToken，使用中间件验证Token
### 2.功能模块
1. 主页刷新:随机返回十个档案到应用中
2. 主页搜索:将匹配搜索关键字的档案返回到应用中
3. 主页删除:将对应档案从数据库中软删除(需要管理员权限)
4. 档案上传:上传档案至数据库中(需要管理员权限)
5. 动态刷新:随机返回十个动态到应用中
6. 动态搜索:将匹配搜索关键字的动态返回到应用中
7. 动态删除:将对应动态从数据库中软删除(需要管理员权限)
8. 动态上传:上传动态至数据库中
9. 移动对接:这个后端项目是有对应的app的，可以下对应app到手机/模拟器里，然后本地部署这个项目测试。（注：app的安卓版本适配API26，建议使用安卓8.0进行测试，用其他的安卓版本出了bug本人概不负责）
10. UI界面:我写的稀丑，交给后人的智慧吧

## 二.项目简介
这是一个配合移动项目写出来的后端项目，集百语言之短，聚古今天下之糟粕，是乃以迪普西克，比利比利，CSDN，稀土撅金，菜鸡编程堆砌之屎山巨作，并由俺寻思之力黏合而成，其寻思，故称其规范屎；bug多，故称其稀烂，自亲濯淖污泥之中，拥抱于浊秽，以贴近尘埃之内，全获世之滋垢，皭然泥而绝滓者也。

![image](https://github.com/user-attachments/assets/44500c5c-163a-47cd-8375-259c712e8f61)

项目名称为“HachiMi”，即韦氏拼音中的“哈基米”。其本来是朝女同学吹牛逼的产物，当时我说“我可以写个app，把学校里的哈基米都存进去”，没想到我还真给这一坨写出来了。
目前还没用HTTPS，因为懒()，之后可能会添加相应功能。
## 三.技术栈
### 1. golang和他的朋友们
- Golang 1.25.0：项目核心开发语言，依托Go的高性能、并发优势等支撑后端服务
- 常用的Golang原生库，如fmt，time，errors等等

### 2. Web框架
- Hertz v0.10.4：字节跳动开发的高性能Golang Web框架，用于快速构建API，实现登录注册注销等接口。

### 3. 数据库相关
- MySQL v1.6.0：核心关系型数据库，存储用户信息、档案/动态数据、权限相关数据
- GORM v1.31.1：Golang主流ORM框架，简化数据库CRUD操作，并且实现“软删除”等功能

### 4. 认证 & 授权
- golang-jwt/jwt v5.3.1：实现双Token（accessToken/refreshToken）机制，支撑Token生成、验证及刷新逻辑
- 自定义中间件：基于Hertz中间件机制，实现Token校验、管理员权限鉴权（如档案/动态删除/上传的权限控制）

### 5. 加密 & 安全
- bcrypt v0.47.0：用于用户密码的加盐哈希加密，保障密码存储安全（由于还没用HTTPS，安全性存疑）

## 四.项目结构说明
整个项目目前分为7层：dao，handler，middleware，model，pkg，router，service。
分层对应的包下面还有多个go文件，其文件名的含义是：
admin：管理员才可以进行的操作
chat：动态相关的操作
home：档案相关的操作
reverso：登录注册注销相关的操作
### 1.dao层：
dao层负责直接和数据库battle，不处理任何业务逻辑，只要调用MySQL搞CRUD就行，其将结果和错误返回给service层。
init_dao用于初始化数据库，其还包含了三个添加测试数据的函数，可以给动态、档案、用户添加20个测试数据。需要时可以用一用。

### 2.handler层：
handler层负责直接与前端交互，接收JSON，发送JSON，序列化，反序列化等等，顺便把错误全部打包，然后发送出去，其将数据传入service层，或者从service层传出数据。

### 3.middleware层：
middleware层负责储存中间件，其有俩中间件：一个是logware，用于记录运行日志；一个是auth，用于进行JWT认证。

### 4.model层：
model层负责储存数据模型和DTO，其包含有normal和reverso两个文件，前者负责储存正常数据，如动态、档案等操作，后者负责储存用户相关的数据，如用户model，token的响应DTO等等。

### 5.pkg层：
pkg，或者utils层，负责当工具人。其储存了一堆杂七杂八的函数，如密码加密，生成Token识别Token，还有错误返回等等。

### 6.router层：
router层负责注册路由，把对应的url与handler的函数绑定，注册中间件等，其他没了。

### 7.service层：
service层专门处理业务逻辑，比如判断前后端的值是不是空值，或者把dao层的错误打包送走，判断错误是业务错误还是内部错误等等，又或者是把DTO转化成model，方便dao层处理数据。

## 五.本地运行指南
### 1.俺寻思之力运行法
（推荐，毕竟已经有app可以用了）  
如果想要测试它，你需要在main.go文件里弄一个你喜欢的端口数字，其他的不需要修改，然后添加init_dao.go里的测试函数到main.go里。
（测试账号的密码统一为123456）
随后，打开你的手机热点，将电脑连接该热点，运行main.go即可。
之后的测试就要看app的功劳了，你需要修改app使用的host，将其修改为你手机热点的IPV4地址，就可以正常运行了。
### 2.AI写的Postman测试
（出bug本人概不负责）  

https://a977628-4731127.postman.co/workspace/SCDOMM's-Workspace~9700a7be-dc73-4ad1-8c5a-09f0fdbcaca4/collection/50290426-4ae5745e-217e-4fca-83c7-03557ce3782b?action=share&source=copy-link&creator=50290426

### 3.部署到Docker，Linux服务器
我还没学，没法写
    
## 六.API文档
目录下有
