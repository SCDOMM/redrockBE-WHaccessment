# redrockBE-WHaccessment

## 一. 已实现功能
### 1. 用户模块
1. 用户注册：顾名思义
2. 用户登录：顾名思义
3. 用户注销：顾名思义
4. 修改个人资料：顾名思义
5. bcrypt加密：使用bcrypt包对密码加盐哈希
6. 刷新Token(双Token)及其中间件：使用refreshToken获得新的accessToken，使用中间件验证Token

### 2. 功能模块
1. 主页刷新：随机返回十个档案到应用中
2. 主页搜索：将匹配搜索关键字的档案返回到应用中
3. 主页删除：将对应档案从数据库中软删除（需要管理员权限）
4. 档案上传：上传档案至数据库中（需要管理员权限）
5. 动态刷新：随机返回十个动态到应用中
6. 动态搜索：将匹配搜索关键字的动态返回到应用中
7. 动态删除：将对应动态从数据库中软删除（需要管理员权限）
8. 动态上传：上传动态至数据库中
9. 移动对接：这个后端项目有对应的app，可下载到手机/模拟器中，本地部署该项目后测试。（注：app的安卓版本适配API26，建议使用安卓8.0测试，其他安卓版本出现bug本人概不负责）
10. UI界面：我写的稀丑，交给后人的智慧吧

## 二. 项目简介
这是一个配合移动项目开发的后端项目，集百语言之短，聚古今天下之糟粕，是依托迪普西克、比利比利、CSDN、稀土掘金、菜鸡编程堆砌的屎山巨作，由俺寻思之力黏合而成——因逻辑全靠“俺寻思”，故称其规范屎；因bug繁多，故称其稀烂。自亲濯淖污泥之中，拥抱浊秽，贴近尘埃，尽获世之滋垢，却仍皭然泥而不滓者也。

![项目相关截图](https://github.com/user-attachments/assets/44500c5c-163a-47cd-8375-259c712e8f61)

项目名称为“HachiMi”（韦氏拼音的“哈基米”）。最初是向女同学吹牛逼的产物，当时我说“我可以写个app，把学校里的哈基米都存进去”，没想到真的把这一坨写出来了。

目前暂未使用HTTPS（因为懒😜），后续可能会添加该功能。

## 三. 技术栈
### 1. Golang 核心
- Golang 1.25.0：项目核心开发语言，依托Go的高性能、并发优势支撑后端服务
- Go原生标准库：如`fmt`、`time`、`errors`等基础库

### 2. Web框架
- Hertz v0.10.4：字节跳动开发的高性能Golang Web框架，用于快速构建API，实现登录、注册、注销等接口

### 3. 数据库相关
- MySQL v1.6.0：核心关系型数据库，存储用户信息、档案/动态数据、权限相关数据
- GORM v1.31.1：Golang主流ORM框架，简化数据库CRUD操作，实现“软删除”等功能

### 4. 认证 & 授权
- golang-jwt/jwt v5.3.1：实现双Token（accessToken/refreshToken）机制，支撑Token生成、验证及刷新逻辑
- 自定义中间件：基于Gin中间件机制，实现Token校验、管理员权限鉴权（如档案/动态删除/上传的权限控制）

### 5. 加密 & 安全
- bcrypt v0.47.0：用于用户密码的加盐哈希加密，保障密码存储安全（因暂未使用HTTPS，安全性存疑）

## 四. 项目结构说明
整个项目分为7层：`dao`、`handler`、`middleware`、`model`、`pkg`、`router`、`service`。
各层包下的Go文件命名含义：
- `admin`：仅管理员可执行的操作
- `chat`：动态相关操作
- `home`：档案相关操作
- `reverso`：登录/注册/注销相关操作

### 1. dao层
dao层负责直接与数据库交互，不处理任何业务逻辑，仅调用MySQL执行CRUD操作，将结果和错误返回给service层。
`init_dao`用于初始化数据库，包含3个添加测试数据的函数（可为动态、档案、用户各添加20条测试数据），按需使用。

### 2. handler层
handler层负责与前端直接交互：接收JSON、返回JSON、序列化/反序列化数据，统一封装错误并返回；同时将数据传入service层，或从service层获取数据。

### 3. middleware层
middleware层存储中间件，包含2个核心中间件：
- `logware`：记录运行日志
- `auth`：执行JWT认证

### 4. model层
model层存储数据模型和DTO：
- `normal`：存储常规数据模型（如动态、档案相关）
- `reverso`：存储用户相关数据（如用户model、Token响应DTO等）

### 5. pkg层
pkg（工具层）负责提供通用工具函数，包含：密码加密、Token生成/解析、错误返回处理等杂项功能。

### 6. router层
router层负责注册路由：将URL与handler函数绑定、注册中间件，无其他业务逻辑。

### 7. service层
service层专门处理业务逻辑：校验前后端参数是否为空、封装dao层错误（区分业务错误/内部错误）、将DTO转换为model（方便dao层处理数据）等。

## 五. 本地运行指南
### 1. 俺寻思之力运行法
1. 在`main.go`中设置自定义端口号（无需修改其他配置）；
2. 将`init_dao.go`中的测试数据函数引入`main.go`（测试账号密码统一为123456）；
3. 打开手机热点，将电脑连接该热点，运行`main.go`；
4. 修改app的请求host为手机热点的IPv4地址，即可正常测试。

### 2. 部署到Docker/Linux服务器
暂未学习相关内容，待补充

## 六. API文档
> 待补充：后续可在此处添加接口地址、请求方式、参数说明、响应示例等内容
